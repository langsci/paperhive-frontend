<div class="row">
  <div class="col-sm-12">
    <div class="form-group">
      <button
        ng-if="$ctrl.isOwner"
        type="button" ng-click="$ctrl.invitationModalOpen()"
        class="btn btn-primary" ng-disabled="!$ctrl.channel.isActive"
        title="{{$ctrl.channel.isActive ? '' : 'Activate the channel first to invite people'}}"
      >
        Invite someone
      </button>

      <h2>Members</h2>
      <table class="table table-hover ph-md-margin-bottom">
        <tr ng-repeat="member in $ctrl.channel.members">
          <td>
            <avatar user="member.person" size="30"
              classes="img-circle ph-sm-margin-right"
            ></avatar>
            {{member.person.displayName}}
            <a href="./users/{{member.person.account.username}}"><small>@{{member.person.account.username}}</small></a>
            <span class="label label-default ph-sm-margin-left"
              ng-repeat="role in member.roles"
            >
              {{role}}
            </span>
            <span class="pull-right">
              <button
                ng-if="$ctrl.isOwner && member.person.id !== $ctrl.authService.user.id"
                type="button" class="btn btn-primary btn-sm"
                ng-click="$ctrl.updateModalOpen(member)"
                ng-disabled="!$ctrl.channel.isActive"
                title="{{$ctrl.channel.isActive ? '' : 'Activate the channel first to update membership'}}"
              >
                Change status
              </button>
              <button
                ng-if="$ctrl.isOwner && member.person.id !== $ctrl.authService.user.id"
                type="button" class="btn btn-danger btn-sm ph-sm-margin-left"
                ng-confirm-click="Really remove this member?"
                confirmed-click="$ctrl.memberDelete($ctrl.channel, member.person.id)"
                ng-disabled="!$ctrl.channel.isActive"
                title="{{$ctrl.channel.isActive ? '' : 'Activate the channel first to remove members'}}"
              >
                Remove member
              </button>
            </span>
          </td>
        </tr>
      </table>

      <div ng-if="$ctrl.channel.invitations.length > 0">
        <h2>
          Invitees
          <span class="badge ph-xs-margin-left">
            {{$ctrl.channel.invitations.length}}
          </span>
        </h2>
        <table class="table table-hover">
          <!-- email invitation -->
          <tr ng-repeat="invitation in $ctrl.channel.invitations">
            <td ng-if="invitation.email">
              {{invitation.email}}
              <span class="label label-default ph-sm-margin-left"
                ng-repeat="role in invitation.roles"
              >
                {{role}}
              </span>
              <button
                ng-if="$ctrl.isOwner"
                type="button" class="btn btn-danger btn-sm pull-right"
                ng-confirm-click="Really remove invitation?"
                confirmed-click="$ctrl.invitationDelete($ctrl.channel.id, invitation.id)"
                ng-disabled="!$ctrl.channel.isActive"
                title="{{$ctrl.channel.isActive ? '' : 'Activate the channel first to remove invitations'}}"
              >
                Remove invitation
              </button>
              <div class="text-muted">
                <small>
                  invited by {{invitation.invitedBy.displayName}}
                  on {{invitation.createdAt | date:'M/d/yyyy HH:mm'}}
                </small>
              </div>
            </td>

            <!-- person invitation -->
            <td ng-if="!invitation.email">
              <avatar user="invitation.person" size="30"
                classes="img-circle ph-sm-margin-right"
              ></avatar>
              {{invitation.person.displayName}}
              <a href="./users/{{invitation.person.account.username}}"><small>@{{invitation.person.account.username}}</small></a>
              <span class="label label-default ph-sm-margin-left"
                ng-repeat="role in invitation.roles"
              >
                {{role}}
              </span>
              <button
                ng-if="$ctrl.isOwner"
                type="button" class="btn btn-danger btn-sm pull-right"
                ng-confirm-click="Really remove invitation?"
                confirmed-click="$ctrl.invitationDelete($ctrl.channel.id, invitation.id)"
                ng-disabled="!$ctrl.channel.isActive"
                title="{{$ctrl.channel.isActive ? '' : 'Activate the channel first to remove invitations'}}"
              >
                Remove invitation
              </button>
              <div class="text-muted">
                <small>
                  invited by {{invitation.invitedBy.displayName}} on
                  {{invitation.createdAt | date:'M/d/yyyy HH:mm'}}
                </small>
              </div>
            </td>
          </tr>
        </table>
      </div>

    </div>
  </div>
</div>
